apply plugin: 'groovy'
apply plugin: 'maven'
apply plugin: 'eclipse'

version = '1.0-SNAPSHOT'
group = 'com.jvoegele.gradle.plugins'

configurations {
    sshDeploy
}

repositories {
    mavenCentral()
}

dependencies {
    sshDeploy 'org.apache.maven.wagon:wagon-ssh:1.0-beta-6'
}

uploadArchives {
    repositories.mavenDeployer {
        //configuration = configurations.sshDeploy
        //repository(url: "scp://jvoegele@chilco.textdrive.com/web/public/maven2")
        repository(url: "file:///tmp/maven2")
    }
}

dependencies {
    // Add all JAR files in the lib directory of theGradle installation directory
    // to the groovy configuration (is also used by compile configuration)
    groovy fileTree(dir: new File(gradle.gradleHomeDir, 'lib'), includes: ['**/*.jar'])
}

// Make sure all code is compiled, tested and checked before uploadArchives.
uploadArchives.dependsOn ':build'

// Task for building in Mousedog devel environment - to call before uploadArchives!
task mousedogBuild << {
	project.version = '1.0-mousedog'
	outputPluginDir = "../clowai/tools/gradle-plugin"
	
	uploadArchives.repositories.mavenDeployer ({repository(url: "file:" + outputPluginDir)})
	
	uploadArchives.doLast {
		// Facility to quickly clean Gradle's plugin cache (think01 devel)
		println "Deleting Gradle's cache for updating plugin..."
		// Home installation
		delete ("/home/fabio/.gradle/cache/com.jvoegele.gradle.plugins")
		// Office installation
	//	delete ("C:/Documents and Settings/71727/.gradle/cache/com.jvoegele.gradle.plugins")
		println "Cache deleted!"
	}
}
